schema: '2.0'
stages:
  fetch_ev:
    cmd: "poetry run python src/data/fetch_ev_data.py\ngit commit -am \"âš¡ Updated
      raw EV data on $(date) with DVC pipeline\" || true\ngit push || true\ndvc push
      || true\n"
    deps:
    - path: src/data/fetch_ev_data.py
      hash: md5
      md5: 3a287f6b63984144808a0ac9b31ee262
      size: 3773
    outs:
    - path: data/raw/ev/ljubljana_ev_availability_combined.json
      hash: md5
      md5: ef2778929b27534f8560761fab0f89bb
      size: 36849
  preprocess_ev:
    cmd: "poetry run python src/data/preprocess_ev_data.py\ngit commit -am \"ðŸ§¹ Preprocessed
      EV data on $(date) with DVC pipeline\" || true\ngit push || true\ndvc push ||
      true\n"
    deps:
    - path: data/raw/ev/ljubljana_ev_availability_combined.json
      hash: md5
      md5: 508afe9e86c46144085e14324f546f45
      size: 36849
    - path: src/data/preprocess_ev_data.py
      hash: md5
      md5: 4bbdbd31b80927dccac3fb1dca85a76c
      size: 2755
    outs:
    - path: data/preprocessed/ev
      hash: md5
      md5: 656c75f2d5486f31c41aedfedad12c6e.dir
      size: 372365
      nfiles: 41
  validate_ev_data:
    cmd: "cd gx && poetry run python run_checkpoint.py\n"
    deps:
    - path: data/preprocessed/ev/
      hash: md5
      md5: 656c75f2d5486f31c41aedfedad12c6e.dir
      size: 372365
      nfiles: 41
    - path: gx/great_expectations.yml
      hash: md5
      md5: 3c20c2f0ad8b37cdc9c4666dcdedd02b
      size: 9136
    - path: gx/run_checkpoint.py
      hash: md5
      md5: 0c0f3b6fcad529b5e025be84b6b01fc4
      size: 4339
    outs:
    - path: gx/uncommitted
      hash: md5
      md5: 16900b25104afd43f5d0f91a347ea43d.dir
      size: 108857054
      nfiles: 4985
  test_ev_data:
    cmd: "poetry run python src/data/test_ev_data.py\n"
    deps:
    - path: data/preprocessed/ev
      hash: md5
      md5: 656c75f2d5486f31c41aedfedad12c6e.dir
      size: 372365
      nfiles: 41
    - path: src/data/test_ev_data.py
      hash: md5
      md5: 9ce83619ab008d568b81aa26f7680cd6
      size: 2678
    outs:
    - path: reports/ev_drift
      hash: md5
      md5: c811efebe9ada27c00781b706ce0b056.dir
      size: 157564806
      nfiles: 41
  train_ev:
    cmd: "poetry run python src/model/train_ev.py\ngit commit -am \"ðŸ¤– Trained EV model
      on $(date) via DVC pipeline\" || true\ngit push || true\ndvc push || true\n"
    deps:
    - path: data/preprocessed/ev
      hash: md5
      md5: 656c75f2d5486f31c41aedfedad12c6e.dir
      size: 372365
      nfiles: 41
    - path: gx/uncommitted
      hash: md5
      md5: 16900b25104afd43f5d0f91a347ea43d.dir
      size: 108857054
      nfiles: 4985
    - path: reports/ev_drift
      hash: md5
      md5: c811efebe9ada27c00781b706ce0b056.dir
      size: 157564806
      nfiles: 41
    - path: src/model/preprocess.py
      hash: md5
      md5: 3cfc826696bacf4a9e5590f3efbf8fce
      size: 1768
    - path: src/model/train_ev.py
      hash: md5
      md5: 10e40ead993099556b66fbc7dc90dc23
      size: 5406
    params:
      params.yaml:
        train_ev.freq: 30m
        train_ev.random_state: 42
        train_ev.target: occupied
        train_ev.test_size: 4
        train_ev.window_size: 3
    outs:
    - path: models/
      hash: md5
      md5: 59b3f44204fce0a98ebfca18ab1a188f.dir
      size: 22544290
      nfiles: 164
  export_and_deploy_frontend:
    cmd: scripts/export_frontend.sh
    deps:
    - path: scripts/export_frontend.sh
      hash: md5
      md5: 56e32657a3808c2ee57da8896dcaf69b
      size: 847
      isexec: true
    - path: src/model/export_mlflow_models.py
      hash: md5
      md5: cfed91ccd78dffe78f3a8dd382b3ecc8
      size: 806
    outs:
    - path: public/ml_models.json
      hash: md5
      md5: 11c2945cdb6fa7cbbe6f2f6238940af7
      size: 523541
  upload_reports:
    cmd: poetry run python src/data/upload_html_to_mongo.py
    deps:
    - path: gx/uncommitted/data_docs/local_site/expectations/
      hash: md5
      md5: 248dafeb2e7c6c38c7e6b109ba29ec49.dir
      size: 1840412
      nfiles: 42
    - path: reports/ev_drift/
      hash: md5
      md5: c811efebe9ada27c00781b706ce0b056.dir
      size: 157564806
      nfiles: 41
    - path: src/data/upload_html_to_mongo.py
      hash: md5
      md5: a9a10749a1aa4e44c93b98848b28582c
      size: 1519
  export_and_deploy_ml_json:
    cmd: "poetry run python src/model/export_mlflow_models.py\npoetry run python src/model/upload_model_json_to_mongo.py\n\
      \ git commit -am \"ðŸ“¦ Exported and synced ML model data on $(date)\" || true\n\
      \ git push || true\ndvc push || true\n"
    deps:
    - path: src/model/export_mlflow_models.py
      hash: md5
      md5: 77a8d7e94719d976ec7533dd613924fb
      size: 833
    - path: src/model/upload_model_json_to_mongo.py
      hash: md5
      md5: 4ef19508b753588b34af88fbd3bc29b2
      size: 802
    outs:
    - path: public/ml_models.json
      hash: md5
      md5: d41d8cd98f00b204e9800998ecf8427e
      size: 0
