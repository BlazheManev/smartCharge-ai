schema: '2.0'
stages:
  fetch_ev:
    cmd: "poetry run python src/data/fetch_ev_data.py\ngit commit -am \"âš¡ Updated
      raw EV data on $(date) with DVC pipeline\" || true\ngit push || true\ndvc push
      || true\n"
    deps:
    - path: src/data/fetch_ev_data.py
      hash: md5
      md5: 3a287f6b63984144808a0ac9b31ee262
      size: 3773
    outs:
    - path: data/raw/ev/ljubljana_ev_availability_combined.json
      hash: md5
      md5: e085a97ae3414d59a0750a415bacd127
      size: 36849
  preprocess_ev:
    cmd: "poetry run python src/data/preprocess_ev_data.py\ngit commit -am \"ðŸ§¹ Preprocessed
      EV data on $(date) with DVC pipeline\" || true\ngit push || true\ndvc push ||
      true\n"
    deps:
    - path: data/raw/ev/ljubljana_ev_availability_combined.json
      hash: md5
      md5: e3f1f2e29190ba36d896da0bec6cfea0
      size: 36849
    - path: src/data/preprocess_ev_data.py
      hash: md5
      md5: fca402c49896198f1697bcd463994594
      size: 2678
    outs:
    - path: data/preprocessed/ev
      hash: md5
      md5: 045eed042f07648261aa64e6cabb8339.dir
      size: 1349165
      nfiles: 41
  validate_ev_data:
    cmd: "cd gx && poetry run python run_checkpoint.py\n"
    deps:
    - path: data/preprocessed/ev/
      hash: md5
      md5: 045eed042f07648261aa64e6cabb8339.dir
      size: 1349165
      nfiles: 41
    - path: gx/great_expectations.yml
      hash: md5
      md5: a16393d260c28ffd4c893a0df7b30eb3
      size: 8902
    - path: gx/run_checkpoint.py
      hash: md5
      md5: 983e4a7b0973f54707633629ab08f0a2
      size: 4225
    outs:
    - path: gx/uncommitted
      hash: md5
      md5: c2ab96e0671a31ad156dd09a72dafa81.dir
      size: 696852922
      nfiles: 19417
  test_ev_data:
    cmd: "poetry run python src/data/test_ev_data.py\n"
    deps:
    - path: data/preprocessed/ev
      hash: md5
      md5: 045eed042f07648261aa64e6cabb8339.dir
      size: 1349165
      nfiles: 41
    - path: src/data/test_ev_data.py
      hash: md5
      md5: bc384044bb131beb80d21f51db9ea27c
      size: 2593
    outs:
    - path: reports/ev_drift
      hash: md5
      md5: a3b3d4e2229efe042791a2e605c673e9.dir
      size: 158512530
      nfiles: 41
  train_ev:
    cmd: "poetry run python src/model/train_ev.py\ngit commit -am \"ðŸ¤– Trained EV model
      on $(date) via DVC pipeline\" || true\ngit push || true\ndvc push || true\n"
    deps:
    - path: data/preprocessed/ev
      hash: md5
      md5: 8a3c4b4c4e89134b38a71cece8f5488c.dir
      size: 1338065
      nfiles: 41
    - path: gx/uncommitted
      hash: md5
      md5: 90559b8dd0d099b08914a6e37812106a.dir
      size: 690170955
      nfiles: 19253
    - path: reports/ev_drift
      hash: md5
      md5: 4e17f7ce0d9ff9390872781aab93451f.dir
      size: 158495674
      nfiles: 41
    - path: src/model/preprocess.py
      hash: md5
      md5: b9da9b572d006dbd072da6c4799897f6
      size: 1711
    - path: src/model/train_ev.py
      hash: md5
      md5: 5c03c31f22f1a5808472148a98bfc92f
      size: 5229
    params:
      params.yaml:
        train_ev.freq: 30m
        train_ev.random_state: 42
        train_ev.target: occupied
        train_ev.test_size: 4
        train_ev.window_size: 3
    outs:
    - path: models/
      hash: md5
      md5: ece7f5b1d7b1a2cfd7f765f78674cb64.dir
      size: 22544290
      nfiles: 164
  export_and_deploy_frontend:
    cmd: scripts/export_frontend.sh
    deps:
    - path: scripts/export_frontend.sh
      hash: md5
      md5: 56e32657a3808c2ee57da8896dcaf69b
      size: 847
      isexec: true
    - path: src/model/export_mlflow_models.py
      hash: md5
      md5: cfed91ccd78dffe78f3a8dd382b3ecc8
      size: 806
    outs:
    - path: public/ml_models.json
      hash: md5
      md5: 11c2945cdb6fa7cbbe6f2f6238940af7
      size: 523541
  upload_reports:
    cmd: poetry run python src/data/upload_html_to_mongo.py
    deps:
    - path: gx/uncommitted/data_docs/local_site/expectations/
      hash: md5
      md5: 919e4b6fb1f7e3f92c192ea9d38c76f1.dir
      size: 1840412
      nfiles: 42
    - path: reports/ev_drift/
      hash: md5
      md5: a3b3d4e2229efe042791a2e605c673e9.dir
      size: 158512530
      nfiles: 41
    - path: src/data/upload_html_to_mongo.py
      hash: md5
      md5: 8d97598f09025695e6092df6f76e9c1a
      size: 1470
  export_and_deploy_ml_json:
    cmd: "poetry run python src/model/export_mlflow_models.py\npoetry run python src/model/upload_model_json_to_mongo.py\n\
      git commit -am \"ðŸ“¦ Exported and synced ML model data on $(date)\" || true\n\
      git push || true\ndvc push || true\n"
    deps:
    - path: src/model/export_mlflow_models.py
      hash: md5
      md5: cfed91ccd78dffe78f3a8dd382b3ecc8
      size: 806
    - path: src/model/upload_model_json_to_mongo.py
      hash: md5
      md5: 28b95ac6bfa8d3239a0a3ddcb77b2bed
      size: 1668
    outs:
    - path: public/ml_models.json
      hash: md5
      md5: 23fb463af3f8ddb6d127bcc6bc1c72f9
      size: 785276
