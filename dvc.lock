schema: '2.0'
stages:
  fetch_ev:
    cmd: "poetry run python src/data/fetch_ev_data.py\ngit commit -am \"âš¡ Updated
      raw EV data on $(date) with DVC pipeline\" || true\ngit push || true\ndvc push
      || true\n"
    deps:
    - path: src/data/fetch_ev_data.py
      hash: md5
      md5: 8ed3b73272cb55f3c7de74c3130d7777
      size: 3780
    outs:
    - path: data/raw/ev/ljubljana_ev_availability_combined.json
      hash: md5
      md5: c41bfaf385409dc2ffd3df299aebdce7
      size: 37957
  preprocess_ev:
    cmd: "poetry run python src/data/preprocess_ev_data.py\ngit commit -am \"ðŸ§¹ Preprocessed
      EV data on $(date) with DVC pipeline\" || true\ngit push || true\ndvc push ||
      true\n"
    deps:
    - path: data/raw/ev/ljubljana_ev_availability_combined.json
      hash: md5
      md5: eadc3202f67248b26a43b49f9f2d2e3b
      size: 37957
    - path: src/data/preprocess_ev_data.py
      hash: md5
      md5: c71157c1dfa8d2d6507295e3c972adf8
      size: 3500
    outs:
    - path: data/preprocessed/ev
      hash: md5
      md5: 901ec925256f26102a23f21965f6af53.dir
      size: 2967904
      nfiles: 41
  validate_ev_data:
    cmd: "cd gx && poetry run python run_checkpoint.py\n"
    deps:
    - path: data/preprocessed/ev/
      hash: md5
      md5: 901ec925256f26102a23f21965f6af53.dir
      size: 2967904
      nfiles: 41
    - path: gx/great_expectations.yml
      hash: md5
      md5: a16393d260c28ffd4c893a0df7b30eb3
      size: 8902
    - path: gx/run_checkpoint.py
      hash: md5
      md5: fb80901141f84ef79ea6c1bab2c672e0
      size: 4229
    outs:
    - path: gx/uncommitted
      hash: md5
      md5: 936bbd383162348aa9b3c166a6e974cb.dir
      size: 1672424727
      nfiles: 43361
  test_ev_data:
    cmd: "poetry run python src/data/test_ev_data.py\n"
    deps:
    - path: data/preprocessed/ev
      hash: md5
      md5: 901ec925256f26102a23f21965f6af53.dir
      size: 2967904
      nfiles: 41
    - path: src/data/test_ev_data.py
      hash: md5
      md5: 5a5755af3c9f15f56e81dbb159349576
      size: 2895
    outs:
    - path: reports/ev_drift
      hash: md5
      md5: 8074669d3d24ee87285be3e71dba2f4f.dir
      size: 158504749
      nfiles: 41
  train_ev:
    cmd: "poetry run python src/model/train_ev.py\ngit commit -am \"ðŸ¤– Trained EV model
      on $(date) via DVC pipeline\" || true\ngit push || true\ndvc push || true\n"
    deps:
    - path: data/preprocessed/ev
      hash: md5
      md5: 4cf32cdd35d1f5e22de3fc7dc40c759f.dir
      size: 2950840
      nfiles: 41
    - path: gx/uncommitted
      hash: md5
      md5: 8701909dee2b7a080db0eb05bc3d9735.dir
      size: 1662401649
      nfiles: 43115
    - path: reports/ev_drift
      hash: md5
      md5: 8074669d3d24ee87285be3e71dba2f4f.dir
      size: 158504749
      nfiles: 41
    - path: src/model/preprocess.py
      hash: md5
      md5: 5501e973a63e9e3a371aff2a7518d848
      size: 1957
    - path: src/model/train_ev.py
      hash: md5
      md5: c1684cfd57b4cc677eed68b3496a94aa
      size: 5638
    params:
      params.yaml:
        train_ev.freq: 1h
        train_ev.random_state: 42
        train_ev.target: occupied
        train_ev.test_size: 4
        train_ev.window_size: 3
    outs:
    - path: models/
      hash: md5
      md5: ec82c92d71afcc9d0d6fe7b32194a861.dir
      size: 22546135
      nfiles: 164
  export_and_deploy_frontend:
    cmd: scripts/export_frontend.sh
    deps:
    - path: scripts/export_frontend.sh
      hash: md5
      md5: 56e32657a3808c2ee57da8896dcaf69b
      size: 847
      isexec: true
    - path: src/model/export_mlflow_models.py
      hash: md5
      md5: cfed91ccd78dffe78f3a8dd382b3ecc8
      size: 806
    outs:
    - path: public/ml_models.json
      hash: md5
      md5: 11c2945cdb6fa7cbbe6f2f6238940af7
      size: 523541
  upload_reports:
    cmd: poetry run python src/data/upload_html_to_mongo.py
    deps:
    - path: gx/uncommitted/data_docs/local_site/expectations/
      hash: md5
      md5: 0499dba972cb06a3f7dfd82ca5a08a8c.dir
      size: 1840412
      nfiles: 42
    - path: reports/ev_drift/
      hash: md5
      md5: 8074669d3d24ee87285be3e71dba2f4f.dir
      size: 158504749
      nfiles: 41
    - path: src/data/upload_html_to_mongo.py
      hash: md5
      md5: 8d97598f09025695e6092df6f76e9c1a
      size: 1470
  export_and_deploy_ml_json:
    cmd: "poetry run python src/model/export_mlflow_models.py\npoetry run python src/model/upload_model_json_to_mongo.py\n\
      git commit -am \"ðŸ“¦ Exported and synced ML model data on $(date)\" || true\n\
      git push || true\ndvc push || true\n"
    deps:
    - path: src/model/export_mlflow_models.py
      hash: md5
      md5: cfed91ccd78dffe78f3a8dd382b3ecc8
      size: 806
    - path: src/model/upload_model_json_to_mongo.py
      hash: md5
      md5: aad77a3aa2baf1f4c3b07186ab5e5e8c
      size: 2431
    outs:
    - path: public/ml_models.json
      hash: md5
      md5: 4edd320280242408cb00de46f98048cb
      size: 1559829
